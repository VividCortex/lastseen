package lastseen

// GetPrimesFrom returns up to count primes >= from.
func GetPrimesFrom(from uint16, count int) []uint16 {
	if count == 0 {
		return nil
	}
	res := make([]uint16, 0, count)
	if from <= 2 {
		res = append(res, 2)
		if count--; count == 0 {
			return res
		}
		from = 3
	}

	ofs := from >> 7          // 0..511
	bit := (from >> 1) & 0x3F // 0..63

	for v := bitprimes[ofs] >> bit; bit < 64; bit++ {
		if v&1 != 0 {
			res = append(res, ofs*128+2*bit+1)
			if count--; count == 0 {
				return res
			}
		}
		v >>= 1
	}

	ofs++ // go to next full qword
	qofs := ofs*128 + 1

	for _, v := range bitprimes[ofs:] {
		for bit = 0; bit < 64; bit++ {
			if v&1 != 0 {
				res = append(res, qofs+2*bit)
				if count--; count == 0 {
					return res
				}
			}
			v >>= 1
		}
		qofs += 128
	}

	return res // returning less than what we were asked
}

// Packed primes < 65536
var bitprimes [65536 / (64 * 2)]uint64 = [65536 / (64 * 2)]uint64{
	0x816d129a64b4cb6e, 0x2196820d864a4c32, 0xa48961205a0434c9, 0x4a2882d129861144, 0x0834992132424030, 0x148a48844225064b, 0x0b40b4086c304205, 0x65048928125108a0,
	0x80124496804c3098, 0xc02104c941124221, 0x0804490000982d32, 0x220825b082689681, 0x9004265940a28948, 0x6900924430434006, 0x12410da408088210, 0x086122d22400c060,
	0x0110d301821b0484, 0x14916022c044a002, 0x092094d204a6400c, 0x4ca2100800522094, 0xa48b081051018200, 0x034c108144309a25, 0x2084490880522502, 0x241140a218003250,
	0x0a41a00101840128, 0x2926000836004512, 0x10100480c0618283, 0xc20c26584822006d, 0x4520582024894810, 0x10c0250219002488, 0x802832ca01140868, 0x60901300264b0400,
	0x32100100d0258082, 0x430800112186430c, 0x0092900c10480424, 0x24880906002d2043, 0x530082090932c040, 0x4000814196800880, 0x2058489608481048, 0x926094022080c329,
	0x05a0104422812000, 0x000a042049019040, 0xc02c801348348924, 0x0800084524002982, 0x04d0048452043698, 0x1865328244908a00, 0x28024001020a0090, 0x861104309204a440,
	0xc90804522c004208, 0x4424990912486084, 0x1000211403002400, 0x4040208805321a01, 0x6030014084c30906, 0xa2020c9011680218, 0x8224148929860004, 0x0880190480084102,
	0x020004a442681210, 0x120100100c061061, 0x6512422194032010, 0x140128040a0c9418, 0x014000d040a40a29, 0x4882402d20410490, 0x24080130100020c1, 0x8229020024845904,
	0x4816814802586100, 0xa0ca000611210010, 0x4200b09104000240, 0x2514480906810c04, 0x860a00a011252092, 0x084520004802c10c, 0x0022130406980032, 0x1282441481480482,
	0xd028804340101824, 0x2c00d86424812004, 0x020000a241081209, 0x180110c04120ca41, 0x20941220a41804a4, 0x048044320240a083, 0x8a6086400c001800, 0x0082010512886400,
	0x04096110c101a24a, 0x0840b40160008801, 0x0494400880030106, 0x02520c028029208a, 0x0264848000844201, 0x2122404430004832, 0x20d004a0c3080200, 0x5228004040161840,
	0x0810180114820890, 0x809320a00a408209, 0x010500522000c008, 0x0000820c06114010, 0x908028009a44904b, 0x0028024309064a04, 0x4480096500180134, 0x1448618202240003,
	0x5108340028120041, 0x6084892890120504, 0x8249402610491012, 0x8840240a01109100, 0x2ca2500004104c10, 0x125001b00a489040, 0x9228a00904a40008, 0x4120022110430002,
	0x00520c0408003281, 0x8101021020844921, 0x6984010122404810, 0x00884402c80130c1, 0x006112c02d02010c, 0x0812014030c000a0, 0x840140948000200b, 0x0b00841000320040,
	0x41848a2906010024, 0x80034c9408081080, 0x5020204140964001, 0x20a44040a2892522, 0x104a212001288602, 0x4225044008140008, 0x2100920410432102, 0x84030922184ca011,
	0x0124228204108941, 0x0900c10884080814, 0x368000028a41b042, 0x0200009124a04904, 0x0806080102924194, 0x80892816d0010009, 0x500c900168000060, 0x4130424080400120,
	0x0049400681252000, 0x1820a00049120108, 0x28241000a6010530, 0x12880020c8200200, 0x420126020092900c, 0x0102422404004916, 0x001008801a0c8088, 0x1169008844940260,
	0x00841324a0120830, 0x30002810c0650082, 0xc801061101200304, 0x0c82100820c20080, 0xb0004006520c0213, 0x1004869801104061, 0x4180416014920884, 0x204140228104101a,
	0x1060340841005229, 0x0884004010012800, 0x0252040448209042, 0x000d820004200800, 0x4020480510024082, 0x00c0240601000099, 0x0844101221048268, 0x0916d020a6400004,
	0x92090c20024124c9, 0x4309004000001240, 0x0024110102982084, 0x3041089003002443, 0x100882804c205824, 0x2010094106812524, 0x244a001080441018, 0xc00030802894010d,
	0x0900020c84106002, 0x20c2041008018202, 0x1100001804060968, 0x0c028221100b0890, 0x024100260008b610, 0x8024201a21244a01, 0x0002402d00024400, 0xa69020001020948b,
	0x016186112c001340, 0x4830810402104180, 0x108a218050282048, 0x4248101009100804, 0x0520c06092820ca0, 0x82080400014020d2, 0x484180480002822d, 0x0084030404910010,
	0x22c06400006804c2, 0x9100860944320840, 0x2400486400012802, 0x8652210043009010, 0x8808204020908b41, 0x6084020020134404, 0x1008003040249081, 0x4320041001020808,
	0x4c800168129040b4, 0x10404912c0080018, 0x104c248941001a24, 0x41204a0910520400, 0x0610081411692248, 0x4000100028848024, 0x2806480826080110, 0x200a048442011400,
	0x1224820008820100, 0x04109040a0404004, 0x10802c2010402290, 0x8101005804004328, 0x0004832120094810, 0xa0106c000044a442, 0xc948808300804844, 0x04b0100502000000,
	0x0408409210290413, 0x1900201900228244, 0x41008a6090810120, 0xa2020004104502c0, 0x4201204921104009, 0x0422014414002c30, 0x1080210489089202, 0x0004804140200105,
	0x01325864b0400912, 0x80c1090441009008, 0x0124009a00900861, 0x0806820526020812, 0x2418002048200008, 0x0009001100020348, 0x04009801104a0184, 0x80812000c0008618,
	0x4a0cb40005301004, 0x4420002802912982, 0xa2014080912c00c0, 0x080020c309041200, 0x2c00000422100c02, 0x32120000c0008611, 0x5005024040808940, 0x4d120a60a4826086,
	0x1402098012089080, 0x9044008a20240148, 0x0012d10002010404, 0x248121320040040a, 0x8908040220841908, 0x4482186802022480, 0x8001280040210042, 0x020c801140208245,
	0x2020400190402400, 0x2009400019282050, 0x0820804060048008, 0x2424110034094930, 0x02920400c2410082, 0x0100a0020c008024, 0x0100d02104416006, 0x1291048412480001,
	0x1841120044240008, 0x2004520080410c26, 0x0218482090240009, 0x8a0014d009a20300, 0x40149820004a2584, 0x144000000005a200, 0x090084802c205801, 0x41b0020802912020,
	0x0218001009003008, 0x0844240000020221, 0x0c021244b2006012, 0x20500420c84080c0, 0x5329040b04b00005, 0x2920820030486100, 0x1043202253001600, 0x004000d204800048,
	0x08040029800344a2, 0x84092830406404c0, 0xc000920221805044, 0x0000800822886010, 0x2081009683048418, 0x5100848845000205, 0x00944b4186512020, 0x80584c2011080080,
	0x0805008920060304, 0x0982004000900522, 0x20c241a000000050, 0xd021264008160008, 0x4402004190810890, 0x049009860a0c1008, 0x8920300804a0c800, 0x0800402c22110084,
	0x200901024801b002, 0x4260028000040304, 0x00020944104a2130, 0xa480218212002401, 0x1840a09104021020, 0x0500096906020004, 0x0000480000010258, 0xc801340020920300,
	0x2080420830084820, 0x0212400401689091, 0x1100a00108120061, 0x0c00922404482104, 0x9612010000048401, 0x8828228841a00140, 0x0114122480424400, 0x108104101a609042,
	0x0240028329060848, 0x4010800510806424, 0x2009018442080202, 0x1340301160005004, 0x4520080900810402, 0x02080c269061104a, 0x0200040260009121, 0x0884480806080c00,
	0x205a00a480000211, 0x0009000204048800, 0x0400c82014490814, 0x101200805940a091, 0x0004000065808000, 0x6084032100194080, 0x808061121a2404c0, 0x0820124209040208,
	0x00a0010120900434, 0x340240929108000b, 0x4000021961108840, 0x2104086880c02504, 0x84010ca000042280, 0x8a20008a08004120, 0x0882110404884800, 0x100040a449098640,
	0x800c805004a20101, 0x41121801a0824800, 0x0001240041480401, 0x0168000200148800, 0x00808308224a0820, 0x34000000c2010489, 0x4a41020228820004, 0x0424800902820590,
	0x1401288092010041, 0x4304b0104c205000, 0x44000201049021a4, 0x2042000608640048, 0x5020004a01920208, 0x0800090422902532, 0x3200051001218011, 0xc10d240808948808,
	0x04121840200b4080, 0x82c1052610402200, 0x0841220224300100, 0x2812d225001a4824, 0x0200413040040042, 0x890884d124201300, 0x00a4184400520480, 0x2042091091200600,
	0x4040840028304024, 0x4004080904100880, 0x8000000219002208, 0x402090012102022c, 0x0120584834000c00, 0x0090001480200443, 0x030020400000116d, 0x65004a0530884010,
	0x8003288418082410, 0x1969100040b04220, 0x0004c20480000004, 0x9608252200050001, 0x012910d000220204, 0x44160104100860a0, 0x8440488202280210, 0x4000048028229020,
	0x6010032980002404, 0x205100a081000048, 0x920420410100d10c, 0x0504420092100000, 0x2052201080408601, 0xd000020a48100021, 0x4800000480484112, 0x1043002400042209,
	0x082c201244000a60, 0x0806400984004420, 0x12980020804000c1, 0xc048840020a21048, 0x0082980812902010, 0x00c328000304a00a, 0x0040040804104244, 0x0480032100100500,
	0x0408040010691288, 0x1820044948840204, 0x0002010830806402, 0x1088412008491252, 0xd005860100340848, 0x4102402184830000, 0x005120a240488010, 0x1840209001004900,
	0x0880400522024002, 0x8201050018201082, 0x0129908104005840, 0x00a20140220064a0, 0x94806000000d0418, 0x120c30800d108260, 0x2120c04012000020, 0x0203448010410258,
	0xc044000829901304, 0x01801a0026002100, 0x320020140a201413, 0x8009204240000861, 0x6800426080810106, 0x8002048042088290, 0x810c009800040b09, 0x0092032884484406,
	0x02810c000a408001, 0x0920029028045108, 0x0ca0810900006010, 0x208028020009a400, 0x0004148104020200, 0x0120406012110904, 0x860a080011403048, 0xd001048160040000,
	0x00200a0090184102, 0x10ca6480080106c1, 0x5020820148809904, 0x0022902084804890, 0x8610242018040019, 0x004410122400c240, 0x0106120024100816, 0x80104d0212009008,
	0x0001104300225040, 0x00140100000a2130, 0x000a2910c1048410, 0x490c120120008a01, 0x6004014800810420, 0x044a4810080c1280, 0x5045844028001028, 0x0980014406106010,
	0x009000a042018600, 0x8008004140229005, 0x4930580100c00802, 0x80020c0241001409, 0x9005100824008940, 0x61120008820a4032, 0x2410042200210400, 0x4020001001040a08,
	0x0012902022880484, 0x140b400401240653, 0x080c90100d028260, 0x2480800914000920, 0x2001440201400082, 0x0041100a4084400c, 0x2020084480090530, 0x2000212043490002,
	0x0208044008b60100, 0x2410084080410180, 0x12c0098612042000, 0x8920020004148121, 0x6900d100801244b4, 0x0418001242008040, 0x0228040221064900, 0x0820006810c00184,
	0x2481011091080040, 0x100086884c10d204, 0x40908a0014020c80, 0x245800a480212018, 0x484130c160101020, 0x0502094000094802, 0x021824204a208211, 0x0300040a0c22100c,
	0x2100020404484806, 0x12020c0018008480, 0x8941108205140001, 0x48840121a4400812, 0x1400280240601002, 0xc200125120a04008, 0x4c128940301a0100, 0xa001011400008002,
	0x0140061821221821, 0x0430024804900080, 0x0448082488050008, 0x0000008000060224, 0x04820a0090116510, 0x02920424486004c3, 0x8029061840808844, 0x2110c84400000110,
	0x141001a04b003089, 0x0065200040940200, 0x2012812022400ca2, 0x0088080010010482, 0x4140804204801100, 0x0424802c32400014, 0x0083200091000019, 0x4040840109204005,
	0x2090414000112020, 0x0618489290400000, 0x1024340148808108, 0x2d06180420000420, 0x220a009000011090, 0x0101841100220001, 0x0122004400882000, 0x001120060240a600,
	0x1928008a04a0c801, 0x09121224a0520080, 0x2400040048012408, 0x4048040008840240, 0x08148801220a6090, 0x90c02000d3080201, 0x0a08b00100001024, 0x20000901008000a0,
	0x8402042400250252, 0x0040a00240921024, 0x0022010804110822, 0x3000219009001442, 0x900922000c00006c, 0x0020c02000402810, 0x1212058201400090, 0x812802806104c109,
	0x2986100804490024, 0x908849300a218041, 0x0941808129044100, 0x4010004010124000, 0x2040210280050248, 0x0048900060205800, 0x4400004880c02880, 0x0212000609000280,
	0x1245108308100001, 0x2020004404082c00, 0x20c80500012010c0, 0x0224001008109804, 0x2412886100884016, 0x061008004200a680, 0x8104205000a04048, 0x01801008001840a4}
